<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerenciador de Câmeras</title>
  <style>
    .camera-container {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 10px;
    }

    .button {
      margin-right: 5px;
    }
  </style>
</head>
<body>

  <h1>Gerenciador de Câmeras</h1>

  <div id="cameraList"></div>

  <h2>Adicionar Nova Câmera</h2>
  <form id="addCameraForm">
    <label for="newCameraLocation">Local:</label>
    <input type="text" id="newCameraLocation" required>
    <button type="button" onclick="addCamera()">Adicionar</button>
  </form>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <script src="client.js"></script>



  <script>
    async function getCamerasAndDisplay() {
      const cameras = await getCameras();
      displayCameras(cameras);
    }

    async function addCamera() {
      const newCameraLocationInput = document.getElementById('newCameraLocation');
      const newCameraLocation = newCameraLocationInput.value;

      if (newCameraLocation.trim() === '') {
        alert('Por favor, insira um local para a nova câmera.');
        return;
      }

      await createCamera(Date.now(), newCameraLocation);
      newCameraLocationInput.value = '';
      getCamerasAndDisplay();
    }

    async function editCamera(id) {
      const newLocation = prompt('Insira o novo local para a câmera:');
      if (newLocation !== null) {
        await updateLastMovement(id, newLocation);
        getCamerasAndDisplay();
      }
    }

    async function deleteCamera(id) {
      const confirmDelete = confirm('Tem certeza que deseja excluir esta câmera?');
      if (confirmDelete) {
        await deleteCamera(id);
        getCamerasAndDisplay();
      }
    }

    function displayCameras(cameras) {
      const cameraListContainer = document.getElementById('cameraList');
      cameraListContainer.innerHTML = ''; // Limpa o conteúdo anterior

      cameras.forEach(camera => {
        const cameraContainer = document.createElement('div');
        cameraContainer.classList.add('camera-container');

        const cameraContent = document.createTextNode(`ID: ${camera.id}, Local: ${camera.location}, Último Movimento: ${camera.lastMovement || 'Nenhum movimento registrado'}`);

        const editButton = document.createElement('button');
        editButton.classList.add('button');
        editButton.textContent = 'Editar';
        editButton.addEventListener('click', () => editCamera(camera.id));

        const deleteButton = document.createElement('button');
        deleteButton.classList.add('button');
        deleteButton.textContent = 'Excluir';
        deleteButton.addEventListener('click', () => deleteCamera(camera.id));

        cameraContainer.appendChild(cameraContent);
        cameraContainer.appendChild(editButton);
        cameraContainer.appendChild(deleteButton);

        cameraListContainer.appendChild(cameraContainer);
      });
    }

    async function getCameras() {
      try {
        const response = await axios.get('http://localhost:3000/cameras');
        return response.data;
      } catch (error) {
        console.error('Erro ao obter controladores de câmera:', error.message);
        return [];
      }
    }

    // Exibindo câmeras ao carregar a página
    getCamerasAndDisplay();
  </script>

</body>
</html>
